# Browser Brain Loop 本轮重构总结（2026-02-25）

## 1. 总体结论

本轮重构已经把系统主链路从“旧接口兼容优先”推进到“新机制优先”：

- Agent 主链路以 Hook/Provider/Capability 机制为核心。
- 能力缺失场景以显式失败为主，不再静默掩盖问题。
- Runtime 在测试稳定性和可观测性上有明显提升。

## 2. 已完成的核心目标

1. Runtime 路由主链路完成能力化收口
- 工具执行路径已经围绕 capability/provider 组织。
- Browser 侧关键能力进入统一能力通道。

2. 旧执行兜底逻辑持续下线
- 已移除一批 legacy adapter 注入路径。
- 已移除关键的 script -> cdp 隐式回退路径。

3. 执行流程可理解性提升
- 工具执行流程已按“解析 -> 计划 -> 分发”拆分，链路更清晰。

4. 测试基础设施修复
- 测试环境补齐 IndexedDB 能力，IDB 相关测试可稳定运行。
- Kernel 关键测试集恢复可用，回归效率提升。

5. 与 Pi 对齐方向持续推进
- 会话、压缩、消息处理与可观测语义继续向对齐目标靠拢。

## 3. 当前仍在进行中的工作

1. 分支内仍有未提交改动（由并行开发产生）
- 主要集中在 BDD live 契约/证据、部分文档与面板展示改动。
- 需要按主题拆分提交，避免混合变更影响评审。

2. 目标体系尚未完全闭环
- “工具契约完全去本机绑定”仍处于推进阶段。
- “多 Provider + 角色化 LLM 路由”已开始，但未完成统一收口。

3. 门禁状态需要在最终提交集上再做一次统一确认
- 需在最终待合并变更集上重新执行完整验证。

## 4. 风险与注意事项（管理视角）

1. 并行改动面较大，提交粒度若不清晰，评审成本会显著上升。
2. 设计切换期内，若目标文档与代码状态不同步，容易造成误判。
3. 需要持续坚持“显式失败优先”，避免旧式静默兜底回流。

## 5. 当前判断

系统已进入“可收口、可并线”的阶段：

- 主架构方向明确且已落地到主链路。
- 剩余工作更多是收口、统一口径和合并治理问题，而非方向性不确定。
