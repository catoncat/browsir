{
  "id": "BHV-CHAT-SHARED-TABS-CONTEXT",
  "intent": "用户分享的 tabs（title/url）必须进入 AI 上下文，并在回复中可观测",
  "context": {
    "surface": "sidepanel.chat",
    "shared_tabs_input": "tabIds",
    "bridge": "connected"
  },
  "steps": [
    "user_selects_tabs_and_sends_prompt",
    "runtime_passes_shared_tabs_reference_to_run_start",
    "kernel_resolves_shared_tabs_metadata_for_current_turn",
    "llm_context_includes_shared_tabs_before_reasoning",
    "assistant_response_can_use_shared_tabs_context"
  ],
  "observables": [
    "session_metadata_contains_shared_tabs_title_url_when_tab_ids_present",
    "assistant_response_uses_shared_tabs_context",
    "empty_tab_ids_clear_shared_tabs_context",
    "same_session_next_send_overwrites_previous_shared_tabs"
  ],
  "risk": "medium",
  "allowed_side_effects": [
    "chrome.tabs.query",
    "session_meta_update",
    "llm_message_context_injection"
  ],
  "proof_requirements": {
    "required_layers": ["unit", "browser-cdp", "e2e"],
    "min_layers": 3
  },
  "degrade_policy": {
    "max_consecutive_failures": 2,
    "on_trigger": [
      "skip_shared_tabs_injection_when_tab_ids_empty",
      "keep_chat_flow_available_without_shared_tabs"
    ]
  },
  "rollback_or_compensation": [
    "shared_tabs_metadata_overwrite_per_send",
    "do_not_persist_stale_shared_tabs_on_empty_tab_ids"
  ],
  "version": "1.1.0"
}
