{
  "id": "BHV-SESSION-STORAGE-RESET-BOOTSTRAP",
  "intent": "Service Worker 启动时应完成 session 索引初始化，并保证 runtime reset 路由返回稳定结果",
  "context": {
    "surface": "service-worker.kernel.storage",
    "startup_event": "onInstalled_or_onStartup",
    "runtime_actions": ["brain.storage.reset", "brain.storage.init"]
  },
  "steps": [
    "bootstrap_session_store_initializes_index",
    "runtime_storage_reset_cleans_session_store_and_rebuilds_index",
    "runtime_storage_init_returns_current_index",
    "runtime_storage_reset_route_returns_consistent_result"
  ],
  "observables": [
    "session_index_is_available_and_writable_after_bootstrap",
    "runtime_storage_reset_removes_session_namespace_keys",
    "runtime_storage_init_returns_index_without_reset_side_effect",
    "storage_reset_response_contains_removed_keys_and_index_summary"
  ],
  "risk": "high",
  "allowed_side_effects": [
    "storage_read(local_keys|session_index)",
    "storage_write(session_index)",
    "storage_remove(session_namespace|trace_namespace)",
    "runtime_message(brain.storage.reset|brain.storage.init)"
  ],
  "proof_requirements": {
    "required_layers": ["unit", "integration", "browser-cdp"],
    "min_layers": 3
  },
  "degrade_policy": {
    "on_reset_failure": [
      "return_error_to_caller",
      "preserve_existing_index_state_when_possible"
    ],
    "on_bootstrap": [
      "always_initialize_index",
      "avoid_conditional_legacy_branches"
    ]
  },
  "rollback_or_compensation": [
    "recreate_empty_session_index_after_reset"
  ],
  "version": "1.1.0"
}
