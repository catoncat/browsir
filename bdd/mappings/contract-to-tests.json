{
  "version": "1.0.0",
  "mappings": [
    {
      "contractId": "BHV-SESSION-TITLE-LIFECYCLE",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/runtime-loop.browser.ts::refreshSessionTitleAuto + extension/src/panel/App.vue::handleRefreshSession"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/session-title.feature"
        }
      ]
    },
    {
      "contractId": "BHV-CHAT-MAX-STEPS-CONFIG",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/runtime-loop.browser.ts::runAgentLoop + extension/src/panel/stores/runtime.ts::saveConfig"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/max-steps-config.feature"
        }
      ]
    },
    {
      "contractId": "BHV-CHAT-NO-TAB-START",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/runtime-router.ts::handleBrainRun + extension/src/sw/kernel/runtime-loop.browser.ts::runAgentLoop + extension/src/sw/kernel/session-manager.browser.ts::appendMessage"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/no-tab-start.feature"
        }
      ]
    },
    {
      "contractId": "BHV-TAB-REF-DEFAULT",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/runtime-loop.browser.ts::queryAllTabsForRuntime + getActiveTabIdForRuntime + executeToolCall(list_tabs/open_tab)"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/tab-ref-default.feature"
        }
      ]
    },
    {
      "contractId": "BHV-CHAT-HISTORY-INCLUDES-TOOL-RESULT",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/runtime-loop.browser.ts::buildLlmMessagesFromContext + runAgentLoop + executeToolCall"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/history-includes-tool-result.feature"
        },
        {
          "layer": "e2e",
          "target": "bdd/evidence/brain-e2e.latest.json::sidepanel 渲染并支持复制/历史分叉/最后一条重试"
        }
      ]
    },
    {
      "contractId": "BHV-CHAT-LIST-OPEN-TABS-TOOLS",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/runtime-loop.browser.ts::BRAIN_TOOL_DEFS + executeToolCall + safeStringify(tool envelope)"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/list-open-tabs-tools.feature"
        },
        {
          "layer": "e2e",
          "target": "bdd/evidence/brain-e2e.latest.json::sidepanel 渲染并支持复制/历史分叉/最后一条重试"
        }
      ]
    },
    {
      "contractId": "BHV-CDP-ON-DEMAND",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/runtime-loop.browser.ts::executeStep + executeToolCall + runAgentLoop"
        },
        {
          "layer": "integration",
          "target": "extension/src/sw/kernel/runtime-infra.browser.ts::handleMessage(cdp.observe|snapshot|action|execute|verify|detach)"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/cdp/on-demand.feature"
        },
        {
          "layer": "e2e",
          "target": "bdd/evidence/brain-e2e.latest.json::brain.run.start 支持 tool_calls 闭环并写入 step stream||LLM 工具超时后可按失败信号调整 timeout 重试成功||CDP 失败后不中断，LLM 可继续推进并完成||LLM HTTP 失败时应产生 auto_retry 事件并失败收口"
        }
      ]
    },
    {
      "contractId": "BHV-PANEL-ACTION-OPEN",
      "proofs": [
        {
          "layer": "integration",
          "target": "extension/src/background/sw-main.ts::chrome.action.onClicked + chrome.sidePanel.open"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/panel/action-open.feature"
        }
      ]
    },
    {
      "contractId": "BHV-CHAT-TOOL-RENDERER-REGISTRY",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/panel/stores/runtime.ts::loadConversation + extension/src/panel/App.vue::message bubble rendering"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/tool-renderer-registry.feature"
        }
      ]
    },
    {
      "contractId": "BHV-CHAT-STREAMING-MESSAGE-CONTAINER",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/orchestrator.browser.ts::persistEvent + extension/src/debug/App.vue::Live Events + Step Stream rendering"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/streaming-message-container.feature"
        }
      ]
    },
    {
      "contractId": "BHV-LLM-CAPABILITY-GATE",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/runtime-loop.browser.ts::requestLlmWithRetry + runAgentLoop + executeToolCall"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/llm-capability-gate.feature"
        },
        {
          "layer": "e2e",
          "target": "bdd/evidence/brain-e2e.latest.json"
        }
      ]
    },
    {
      "contractId": "BHV-LLM-LIVE-CAPABILITY",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/runtime-loop.browser.ts::requestLlmWithRetry + runAgentLoop + executeToolCall"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/llm-live-capability.feature"
        },
        {
          "layer": "e2e",
          "target": "bdd/evidence/brain-e2e-live.latest.json"
        }
      ]
    },
    {
      "contractId": "BHV-SESSION-METADATA-SPLIT-STORAGE",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/session-store.browser.ts::appendEntryChunk + readEntryChunks + appendTraceChunk"
        },
        {
          "layer": "integration",
          "target": "extension/src/sw/kernel/session-manager.browser.ts::appendEntry + extension/src/sw/kernel/runtime-router.ts::buildConversationView + extension/src/sw/kernel/orchestrator.browser.ts::getStepStream"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/storage/session-metadata-split-storage.feature"
        }
      ]
    },
    {
      "contractId": "BHV-SESSION-COMPACTION-STATE-MACHINE",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/__tests__/orchestrator.browser.test.ts::handleAgentEnd retry/overflow branches + compaction events"
        },
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/__tests__/compaction.browser.test.ts::shouldCompact + findCutPoint + prepareCompaction"
        },
        {
          "layer": "integration",
          "target": "extension/src/sw/kernel/orchestrator.browser.ts::preSendCompactionCheck + handleAgentEnd + runCompaction + persistEvent"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/session/compaction-state-machine.feature"
        }
      ]
    },
    {
      "contractId": "BHV-AGENT-HOOK-LIFECYCLE",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/__tests__/orchestrator.browser.test.ts::tool.before_call block + tool.after_result patch + compaction.check + agent_end.after"
        },
        {
          "layer": "integration",
          "target": "extension/src/sw/kernel/orchestrator.browser.ts::runHook + executeStep + preSendCompactionCheck + handleAgentEnd + runCompaction"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/session/agent-hook-lifecycle.feature"
        },
        {
          "layer": "e2e",
          "target": "bdd/evidence/brain-e2e.latest.json"
        }
      ]
    },
    {
      "contractId": "BHV-CAPABILITY-PROVIDER-ROUTING",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/__tests__/orchestrator.browser.test.ts::script success/fallback/cdp fail/missing cdp adapter"
        },
        {
          "layer": "integration",
          "target": "extension/src/sw/kernel/orchestrator.browser.ts::wireLegacyAdapters + registerToolProvider + invokeProviderWithHooks + executeStep"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/session/capability-provider-routing.feature"
        },
        {
          "layer": "e2e",
          "target": "bdd/evidence/brain-e2e.latest.json"
        }
      ]
    },
    {
      "contractId": "BHV-SESSION-LIST-TITLE-DELETE",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/runtime-router.ts::deriveSessionTitle + handleSession(brain.session.title.refresh|brain.session.delete)"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/session/list-title-delete.feature"
        },
        {
          "layer": "e2e",
          "target": "bdd/evidence/brain-e2e.latest.json"
        }
      ]
    },
    {
      "contractId": "BHV-SESSION-STORAGE-RESET-BOOTSTRAP",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/sw/kernel/storage-reset.browser.ts::archiveLegacyState + resetSessionStore"
        },
        {
          "layer": "integration",
          "target": "extension/src/background/sw-main.ts::bootstrapSessionStore + legacy detection + brain.bootstrap broadcast"
        },
        {
          "layer": "integration",
          "target": "extension/src/sw/kernel/runtime-router.ts::handleStorage(brain.storage.archive|brain.storage.reset|brain.storage.init)"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/storage/session-reset-bootstrap.feature"
        }
      ]
    },
    {
      "contractId": "BHV-CHAT-MESSAGE-ACTIONS-RETRY-COPY",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/panel/utils/message-actions.ts::canForkMessage+canRetryMessage + extension/src/panel/App.vue::handleEditMessage + extension/src/panel/components/ChatMessage.vue::user/assistant action rendering + extension/src/panel/stores/runtime.ts::forkFromAssistantEntry+retryLastAssistantEntry + extension/src/sw/kernel/runtime-router.ts::handleSession(brain.session.fork)+handleBrainRun(brain.run.regenerate)"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/message-actions-retry-copy.feature"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/regenerate-answer.feature"
        },
        {
          "layer": "e2e",
          "target": "bdd/evidence/brain-e2e.latest.json"
        }
      ]
    },
    {
      "contractId": "BHV-CHAT-SHARED-TABS-CONTEXT",
      "proofs": [
        {
          "layer": "unit",
          "target": "extension/src/panel/stores/runtime.ts::sendPrompt + extension/src/sw/kernel/runtime-loop.browser.ts::startFromPrompt + buildLlmMessagesFromContext"
        },
        {
          "layer": "browser-cdp",
          "target": "bdd/features/chat/shared-tabs-context.feature"
        },
        {
          "layer": "e2e",
          "target": "bdd/evidence/brain-e2e.latest.json::brain.run.start 注入 shared tabs 上下文并每次覆盖"
        }
      ]
    }
  ]
}
